extends ../layouts/main

mixin linked_account(name, icon, shortname, userId, token)
  div.btn-group
    button.btn.btn-default.linked-account(type="button",id=shortname,userId=userId,connected=(token != undefined))
      if icon
        i(class="fa fa-" + icon)
        | &nbsp;<span class="connect">Connect</span><span class="disconnect" style="display: none;">Disconnect</span> #{name}
      else
        | <span class="connect">Connect</span><span class="disconnect" style="display: none;">Disconnect</span> #{name}      

mixin broken(name, icon, shortname, userId, token)
    if token
      a.btn.btn-default.btn-danger(href=url,role="button")
        if icon
          i(class="fa fa-" + icon)
          | &nbsp;Disconnect #{name}
        else
          | Disconnect #{name}
    else
      button.btn.btn-default(type="button",shortname=shortname)
        if icon
          i(class="fa fa-" + icon)
          | &nbsp;Connect #{name}
        else
          | Connect #{name}        

block title
  #{title}
  
block content
 .container
    div.row
      .col-sm-3
          a(href="http://www.gravatar.com/#{person.gravatar}")
            img.center-block.img-rounded(src="https://secure.gravatar.com/avatar/#{person.gravatar}.jpg?d=retro&s=160")
          if person.displayName && person.displayName.length > 0
            h2 #{person.displayName}
              span.small &nbsp;(#{person.name})
          else
            h2 #{person.name}          
          div.list-group
            if (!(person.visibility )) || (person.visibility == "none")
              span.list-group-item <i class="fa fa-eye-slash"></i>&nbsp;Only visible to <strong>#{person.pronouned}</strong>
            if (person.visibility == "users")
              span.list-group-item <i class="fa fa-eye"></i>&nbsp;Visible to other <strong>learners</strong>
            if (person.visibility == "everyone")
              span.list-group-item <i class="fa fa-eye"></i>&nbsp;Visible to <strong>everyone</strong>
            if person.website && person.website.length > 0                     
              span.list-group-item <i class="fa fa-external-link"></i>&nbsp;
                a(href=person.website) #{person.website}
            if person.location && person.location.length > 0           
              span.list-group-item <i class="fa fa-location-arrow"></i>&nbsp;
                a(href="http://maps.google.com/?=q=" + person.location) #{person.location}
            if person.email && person.email.length > 0
              span.list-group-item <i class="fa fa-envelope-o"></i>&nbsp;
                a.email(href="mailto:#{person.email}") #{person.email}
            if person.birthday                                    
              span.list-group-item <i class="fa fa-birthday-cake"></i>&nbsp;
                time(class="absolute-date", datetime=person.birthday)
                  | #{person.formattedBirthday}            
            //span.list-group-item <i class="fa fa-eye"></i>&nbsp;
            //  time(class="relative-date", datetime=person.lastSeen)
            //    | #{person.lastSeen}
      .col-sm-9
        .row
          .col-sm-9
            if updated
              div.alert.alert-success(role="alert")
                button(type="button",class="close",data-dismiss="alert",aria-label="Close")
                  span(aria-hidden=true) &times;
                strong Updated.&nbsp;
                | The public profile has been changed.
          .col-sm-3                
            if (user.superuser) || (user._id.toString() === person._id.toString())
              div.btn-toolbar(style="margin-bottom: 15px;")
                div.btn-group.pull-right
                  a.btn.btn-primary(role="button", href="/users/#{person._id}/edit") <i class="fa fa-pencil"></i> Edit Profile
        if person.biography && person.biography.length > 0
          .row
            .col-sm-12
              div.panel.panel-default
               div.panel-heading
                  h3.panel-title About
                div.panel-body
                  p #{person.biography}
        .row
          .col-sm-12
            div.panel.panel-default
              div.panel-heading
                h3.panel-title Linked accounts        
              div.panel-body
                div.btn-toolbar(role="toolbar")
                  mixin linked_account('Google', 'google', 'google', person._id, person.googleOpenId )
                  mixin linked_account('Coursera', undefined, 'coursera', person._id, person.courseraOAuthId )
                  mixin linked_account('GitHub', 'github-alt', 'github', person._id, person.githubId )
                  mixin linked_account('Twitter', 'twitter', 'twitter', person._id, person.twitterOAuthId )            
                          
